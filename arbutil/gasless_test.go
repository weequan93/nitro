package arbutil

import (
	"encoding/hex"
	"math/big"
	"testing"

	"github.com/ethereum/go-ethereum/core/types"
)

func TestIsGaslessTx(t *testing.T) {
	// https://web3playground.io/QmVUNCDSFoPQ9d1npLyEP7oJUJr3tymvX9FU9ikjhJeJSo
	data, _ := hex.DecodeString("b4e9984f00000000000000000000000000000000000000000000000000000000000000200000000000000000000000001df923e4f009663b0fddc1775dac783b85f432fb00000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000271c970000000000000000000000000000000000000000000000000000000000005cc300000000000000000000000000000000000000000000000000000000000061a800000000000000000000000000000000000000000000000000000000000061a800000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000002ffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000141df923e4f009663b0fddc1775dac783b85f432fb000000000000000000000000")

	inner := types.LegacyTx{
		Nonce:    1,
		GasPrice: big.NewInt(0),
		Gas:      1000000,
		To:       &ENTRYPOINT_CONTRACT,
		Value:    big.NewInt(1),
		Data:     data,
	}

	tx := types.NewTx(&inner)

	if !IsGaslessTx(tx) {
		t.Fail()
	}
}
